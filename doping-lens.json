{
  "resourceType": "Library",
  "id": "doping-lens",
  "meta": {
    "profile": [
      "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lens"
    ]
  },
  "type": {
    "coding": [
      {
        "code": "logical-library"
      }
    ]
  },
  "extension": [
    {
      "url": "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lee-version",
      "valueString": "dev"
    }
  ],
  "url": "http://hl7.eu/fhir/ig/gravitate-health/Library/588",
  "identifier": [
    {
      "system": "http://gravitate-health.lst.tfo.upm.es",
      "value": "doping-lens"
    }
  ],
  "version": "0.0.1",
  "name": "Doping lens",
  "_name": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente para el doping"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente de aviso doping"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse til doping"
          }
        ]
      }
    ]
  },
  "title": "doping-lens",
  "_title": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente para aviso doping"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente para aviso doping"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse til doping"
          }
        ]
      }
    ]
  },
  "status": "draft",
  "experimental": true,
  "date": "2024-06-12T12:23:10.005Z",
  "publisher": "Gravitate Health Project - UPM Team",
  "contact": [
    {
      "name": "Gravitate Health",
      "telecom": [
        {
          "system": "url",
          "value": "https://www.gravitatehealth.eu/"
        }
      ]
    }
  ],
  "description": "Lens that highlights doping-related information for professional athletes when the medication contains WADA prohibited substances",
  "_description": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente que resalta información relacionada con el doping para atletas profesionales cuando el medicamento contiene sustancias prohibidas por la WADA"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente que destaca informações relacionadas com doping para atletas profissionais quando o medicamento contém substâncias proibidas pela WADA"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse der fremhæver dopingrelaterede oplysninger for professionelle atleter når medicinen indeholder WADA-forbudte stoffer"
          }
        ]
      }
    ]
  },
  "jurisdiction": [
    {
      "coding": [
        {
          "code": "EU",
          "system": "urn:iso:std:iso:3166"
        }
      ]
    }
  ],
  "purpose": "Highlight doping-related warnings in a preprocessed ePI when the patient is a professional athlete and the medication contains WADA prohibited substances.",
  "_purpose": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Resaltar advertencias relacionadas con el doping en una ePI preprocesada cuando el paciente es un atleta profesional y el medicamento contiene sustancias prohibidas por la WADA."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Destacar avisos relacionados com doping em uma ePI pré-processada quando o paciente é um atleta profissional e o medicamento contém substâncias proibidas pela WADA."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Fremhæv dopingrelaterede advarsler i en forbehandlet ePI når patienten er professionel atlet og medicinen indeholder WADA-forbudte stoffer."
          }
        ]
      }
    ]
  },
  "usage": "You can import this lens directly to your FHIR Server which suports Library Resource type.",
  "_usage": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Puedes importar esta lente directamente a tu servidor FHIR que soporte el tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Podes importar esta lente diretamente para o teu servidor FHIR que suporte o tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Du kan importere denne linse direkte til din FHIR-server, som understøtter ressource-typen Library."
          }
        ]
      }
    ]
  },
  "copyright": "© 2024 Gravitate Health",
  "parameter": [
    {
      "use": "in",
      "documentation": "parameter if it exists",
      "type": "CodeableConcept"
    }
  ],
  "content": [
    {
      "contentType": "application/javascript",
      "title": "Lens for doping warning",
      "data": "bGV0IHB2RGF0YSA9IHB2OwpsZXQgaHRtbERhdGEgPSBodG1sOwoKbGV0IGVwaURhdGEgPSBlcGk7CmxldCBpcHNEYXRhID0gaXBzOwoKbGV0IGdldFNwZWNpZmljYXRpb24gPSAoKSA9PiB7CiAgcmV0dXJuICIxLjAuMCI7Cn07CgovL1RPRE8gY2hlY2sgaWYgbWVkaWNhdGlvbiBoYXMgdGhlIHRleHQgb24gaXQgLSBpbiBQVCB0aGVyZSBpcyB0aGF0IGluZm8sIGZvciBleGFtcGxlIC0gY3JlYXRlIGVQSSBmb3IgaXQuCi8vVE9ETyBleHBsb3JlIGlmIGNvdWxkIGFkZCBhbHNvIG9uIHRvcCBzb21ldGhpbmcgaWYgbm90IHRoZXJlLgpsZXQgYW5ub3RhdGlvblByb2Nlc3MgPSAobGlzdE9mQ2F0ZWdvcmllcywgZW5oYW5jZVRhZywgZG9jdW1lbnQsIHJlc3BvbnNlKSA9PiB7CiAgbGlzdE9mQ2F0ZWdvcmllcy5mb3JFYWNoKChjaGVjaykgPT4gewogICAgaWYgKHJlc3BvbnNlLmluY2x1ZGVzKGNoZWNrKSkgewogICAgICBsZXQgZWxlbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNoZWNrKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgIGVsZW1lbnRzW2ldLmNsYXNzTGlzdC5hZGQoZW5oYW5jZVRhZyk7CiAgICAgICAgZWxlbWVudHNbaV0uY2xhc3NMaXN0LmFkZCgiZG9waW5nLWxlbnMiKTsKICAgICAgfQogICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKS5sZW5ndGggPiAwKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXS5yZW1vdmUoKTsKICAgICAgfQogICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKS5sZW5ndGggPiAwKSB7CiAgICAgICAgcmVzcG9uc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdLmlubmVySFRNTDsKICAgICAgICBjb25zb2xlLmxvZygiUmVzcG9uc2U6ICIgKyByZXNwb25zZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5sb2coIlJlc3BvbnNlOiAiICsgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmlubmVySFRNTCk7CiAgICAgICAgcmVzcG9uc2UgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuaW5uZXJIVE1MOwogICAgICB9CiAgICB9CiAgfSk7CgogIGlmIChyZXNwb25zZSA9PSBudWxsIHx8IHJlc3BvbnNlID09ICIiKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICJBbm5vdGF0aW9uIHByb2NjZXNzIGZhaWxlZDogUmV0dXJuZWQgZW1wdHkgb3IgbnVsbCByZXNwb25zZSIKICAgICk7CiAgICAvL3JldHVybiBodG1sRGF0YQogIH0gZWxzZSB7CiAgICBjb25zb2xlLmxvZygiUmVzcG9uc2U6ICIgKyByZXNwb25zZSk7CiAgICByZXR1cm4gcmVzcG9uc2U7CiAgfQp9CgoKbGV0IGFubm90YXRlSFRNTHNlY3Rpb24gPSBhc3luYyAobGlzdE9mQ2F0ZWdvcmllcywgZW5oYW5jZVRhZykgPT4gewogIGxldCByZXNwb25zZSA9IGh0bWxEYXRhOwogIGxldCBkb2N1bWVudDsKCiAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICJ1bmRlZmluZWQiKSB7CiAgICBsZXQganNkb20gPSBhd2FpdCBpbXBvcnQoImpzZG9tIik7CiAgICBsZXQgeyBKU0RPTSB9ID0ganNkb207CiAgICBsZXQgZG9tID0gbmV3IEpTRE9NKGh0bWxEYXRhKTsKICAgIGRvY3VtZW50ID0gZG9tLndpbmRvdy5kb2N1bWVudDsKICAgIHJldHVybiBhbm5vdGF0aW9uUHJvY2VzcyhsaXN0T2ZDYXRlZ29yaWVzLCBlbmhhbmNlVGFnLCBkb2N1bWVudCwgcmVzcG9uc2UpOwogIH0gZWxzZSB7CiAgICBkb2N1bWVudCA9IHdpbmRvdy5kb2N1bWVudDsKICAgIHJldHVybiBhbm5vdGF0aW9uUHJvY2VzcyhsaXN0T2ZDYXRlZ29yaWVzLCBlbmhhbmNlVGFnLCBkb2N1bWVudCwgcmVzcG9uc2UpOwogIH0KfTsKCgoKbGV0IGVuaGFuY2UgPSBhc3luYyAoKSA9PiB7CiAgaWYgKCFpcHNEYXRhIHx8ICFpcHNEYXRhLmVudHJ5IHx8IGlwc0RhdGEuZW50cnkubGVuZ3RoID09PSAwKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIklQUyBpcyBlbXB0eSBvciBpbnZhbGlkLiIpOwogIH0KICBpZiAoIWVwaURhdGEgfHwgIWVwaURhdGEuZW50cnkgfHwgZXBpRGF0YS5lbnRyeS5sZW5ndGggPT09IDApIHsKICAgIHRocm93IG5ldyBFcnJvcigiZVBJIGlzIGVtcHR5IG9yIGludmFsaWQuIik7CiAgfQogIGxldCBlbmhhbmNlVGFnID0gImhpZ2hsaWdodCI7CiAgLy8gTWF0Y2ggbGlzdHMKICBjb25zdCBXQURBX0JVTkRMRV9JREVOVElGSUVSX0xJU1QgPSBbImVwaWJ1bmRsZS0xMjMiLCAiZXBpYnVuZGxlLWFiYyJdOwogIGNvbnN0IFdBREFfTElTVCA9IFsKICAgICIxMTE1MDA5IiwgLy8gRXhhbXBsZTogVGVzdG9zdGVyb25lCiAgICAiMTIzNDU2NyIsIC8vIEV4YW1wbGU6IEVyeXRocm9wb2lldGluIChFUE8pCiAgICAiMjA0NDMyIiwgIC8vIEV4YW1wbGU6IENsZW5idXRlcm9sCiAgICAiMzYwMTQ3IiAgIC8vIEV4YW1wbGU6IE94YW5kcm9sb25lCiAgXTsKCiAgbGV0IGxpc3RPZkNhdGVnb3JpZXNUb1NlYXJjaCA9IFsiZ3Jhdi0yIl07IC8vd2hhdCB0byBsb29rIGluIGV4dGVuc2lvbiB0byBmaW5kIGNsYXNzCiAgLy8gc2hvdWxkIHdlIGFkZCB0aGUgd2FybmluZyBldmVuIHdpdGhvdXQgdGhlIGNsYXNzPz8gLSBzZWUgcXVlc3Rpb25uYWlyZSBsZW5zCgogIGxldCBpc1Byb2Zlc3Npb25hbEF0aGxldGUgPSBmYWxzZTsKICBsZXQgaXNQcm9oaWJpdGVkRHJ1ZyA9IGZhbHNlOwoKCiAgZm9yIChjb25zdCBlbnRyeSBvZiBpcHNEYXRhLmVudHJ5KSB7CiAgICBjb25zdCByZXMgPSBlbnRyeS5yZXNvdXJjZTsKICAgIGlmICghcmVzKSBjb250aW51ZTsKCiAgICAvLyAxLiBDaGVjayBQYXRpZW50IGV4dGVuc2lvbgogICAgaWYgKHJlcy5yZXNvdXJjZVR5cGUgPT09ICJQYXRpZW50IiAmJiBBcnJheS5pc0FycmF5KHJlcy5leHRlbnNpb24pKSB7CiAgICAgIGZvciAoY29uc3QgZXh0IG9mIHJlcy5leHRlbnNpb24pIHsKICAgICAgICAvL2NvbnNvbGUubG9nKGV4dC52YWx1ZUNvZGVhYmxlQ29uY2VwdC5jb2RpbmcpCiAgICAgICAgaWYgKAogICAgICAgICAgZXh0LnVybCA9PT0gImh0dHA6Ly9obDcub3JnL2ZoaXIvU3RydWN0dXJlRGVmaW5pdGlvbi9pbmRpdmlkdWFsLW9jY3VwYXRpb24iICYmCiAgICAgICAgICBleHQudmFsdWVDb2RlYWJsZUNvbmNlcHQuY29kaW5nWzBdLmNvZGUgPT0gIjM0MjEiIC8vQXRobGV0ZXMgYW5kIHNwb3J0cyBwbGF5ZXJzIgogICAgICAgICAgJiYgZXh0LnZhbHVlQ29kZWFibGVDb25jZXB0LmNvZGluZ1swXS5zeXN0ZW0gPT0gImh0dHA6Ly93d3cuaWxvLm9yZy9wdWJsaWMvZW5nbGlzaC9idXJlYXUvc3RhdC9pc2NvIgogICAgICAgICkgewogICAgICAgICAgaXNQcm9mZXNzaW9uYWxBdGhsZXRlID0gdHJ1ZTsKICAgICAgICAgIGNvbnNvbGUubG9nKCLwn4+D4oCN4pmC77iPIEF0aGxldGUgc3RhdHVzOiBwcm9mZXNzaW9uYWwiKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICAvL3NlYXJjaCBJUFMgdG8gbG9vayBpdCB1cCBhcyB3ZWxsCiAgaXBzLmVudHJ5LmZvckVhY2goKGVudHJ5KSA9PiB7CiAgICBjb25zdCByZXNvdXJjZSA9IGVudHJ5LnJlc291cmNlOwoKICAgIGlmIChyZXNvdXJjZS5yZXNvdXJjZVR5cGUgPT09ICJPYnNlcnZhdGlvbiIpIHsKICAgICAgLy8gQ2hlY2sgaWYgY2F0ZWdvcnkgY29udGFpbnMgdGhlIHNvY2lhbC1oaXN0b3J5IGNvZGUKICAgICAgY29uc3QgaGFzU29jaWFsSGlzdG9yeUNhdGVnb3J5ID0gcmVzb3VyY2UuY2F0ZWdvcnk/LnNvbWUoY2F0ID0+CiAgICAgICAgY2F0LmNvZGluZz8uc29tZShjb2RpbmcgPT4KICAgICAgICAgIGNvZGluZy5zeXN0ZW0gPT09ICJodHRwOi8vdGVybWlub2xvZ3kuaGw3Lm9yZy9Db2RlU3lzdGVtL29ic2VydmF0aW9uLWNhdGVnb3J5IiAmJgogICAgICAgICAgY29kaW5nLmNvZGUgPT09ICJzb2NpYWwtaGlzdG9yeSIKICAgICAgICApCiAgICAgICk7CgogICAgICAvLyBDaGVjayBpZiBjb2RlIGlzIDExMzQxLTUgKEhpc3Rvcnkgb2YgT2NjdXBhdGlvbikKICAgICAgY29uc3QgaGFzT2NjdXBhdGlvbkNvZGUgPSByZXNvdXJjZS5jb2RlPy5jb2Rpbmc/LnNvbWUoY29kaW5nID0+CiAgICAgICAgY29kaW5nLnN5c3RlbSA9PT0gImh0dHA6Ly9sb2luYy5vcmciICYmCiAgICAgICAgY29kaW5nLmNvZGUgPT09ICIxMTM0MS01IgogICAgICApOwoKICAgICAgLy8gQ2hlY2sgaWYgdmFsdWVDb2RlYWJsZUNvbmNlcHQgaW5kaWNhdGVzIGF0aGxldGUKICAgICAgY29uc3QgaGFzQXRobGV0ZVZhbHVlID0gcmVzb3VyY2UudmFsdWVDb2RlYWJsZUNvbmNlcHQ/LmNvZGluZz8uc29tZShjb2RpbmcgPT4KICAgICAgICBjb2Rpbmcuc3lzdGVtID09PSAiaHR0cDovL3d3dy5pbG8ub3JnL3B1YmxpYy9lbmdsaXNoL2J1cmVhdS9zdGF0L2lzY28iICYmCiAgICAgICAgY29kaW5nLmNvZGUgPT09ICIzNDIxIgogICAgICApOwoKICAgICAgaWYgKGhhc1NvY2lhbEhpc3RvcnlDYXRlZ29yeSAmJiBoYXNPY2N1cGF0aW9uQ29kZSAmJiBoYXNBdGhsZXRlVmFsdWUpIHsKICAgICAgICBpc1Byb2Zlc3Npb25hbEF0aGxldGUgPSB0cnVlOwogICAgICAgIGNvbnNvbGUubG9nKCJBdGhsZXRlIHN0YXR1cyBkZXRlY3RlZCBmcm9tIE9ic2VydmF0aW9uIGZyb20gcGVyc29uYSB2ZWN0b3I6IiwgcmVzb3VyY2UuaWQpOwogICAgICB9CiAgICB9CiAgfSk7CgogIC8vIHNlYXJjaCBwZXJzb25hIHZlY3RvciB0byBsb29rIGl0IHVwIGFzIHdlbGwKICBjb25zdCBwdkVudHJpZXMgPSBBcnJheS5pc0FycmF5KHB2Py5lbnRyeSkgPyBwdi5lbnRyeSA6IFtdOwogIHB2RW50cmllcy5mb3JFYWNoKChlbnRyeSkgPT4gewogICAgY29uc3QgcmVzb3VyY2UgPSBlbnRyeS5yZXNvdXJjZTsKCiAgICBpZiAocmVzb3VyY2UucmVzb3VyY2VUeXBlID09PSAiT2JzZXJ2YXRpb24iKSB7CiAgICAgIC8vIENoZWNrIGlmIGNhdGVnb3J5IGNvbnRhaW5zIHRoZSBzb2NpYWwtaGlzdG9yeSBjb2RlCiAgICAgIGNvbnN0IGhhc1NvY2lhbEhpc3RvcnlDYXRlZ29yeSA9IHJlc291cmNlLmNhdGVnb3J5Py5zb21lKGNhdCA9PgogICAgICAgIGNhdC5jb2Rpbmc/LnNvbWUoY29kaW5nID0+CiAgICAgICAgICBjb2Rpbmcuc3lzdGVtID09PSAiaHR0cDovL3Rlcm1pbm9sb2d5LmhsNy5vcmcvQ29kZVN5c3RlbS9vYnNlcnZhdGlvbi1jYXRlZ29yeSIgJiYKICAgICAgICAgIGNvZGluZy5jb2RlID09PSAic29jaWFsLWhpc3RvcnkiCiAgICAgICAgKQogICAgICApOwoKICAgICAgLy8gQ2hlY2sgaWYgY29kZSBpcyAxMTM0MS01IChIaXN0b3J5IG9mIE9jY3VwYXRpb24pCiAgICAgIGNvbnN0IGhhc09jY3VwYXRpb25Db2RlID0gcmVzb3VyY2UuY29kZT8uY29kaW5nPy5zb21lKGNvZGluZyA9PgogICAgICAgIGNvZGluZy5zeXN0ZW0gPT09ICJodHRwOi8vbG9pbmMub3JnIiAmJgogICAgICAgIGNvZGluZy5jb2RlID09PSAiMTEzNDEtNSIKICAgICAgKTsKCiAgICAgIC8vIENoZWNrIGlmIHZhbHVlQ29kZWFibGVDb25jZXB0IGluZGljYXRlcyBhdGhsZXRlCiAgICAgIGNvbnN0IGhhc0F0aGxldGVWYWx1ZSA9IHJlc291cmNlLnZhbHVlQ29kZWFibGVDb25jZXB0Py5jb2Rpbmc/LnNvbWUoY29kaW5nID0+CiAgICAgICAgY29kaW5nLnN5c3RlbSA9PT0gImh0dHA6Ly93d3cuaWxvLm9yZy9wdWJsaWMvZW5nbGlzaC9idXJlYXUvc3RhdC9pc2NvIiAmJgogICAgICAgIGNvZGluZy5jb2RlID09PSAiMzQyMSIKICAgICAgKTsKCiAgICAgIGlmIChoYXNTb2NpYWxIaXN0b3J5Q2F0ZWdvcnkgJiYgaGFzT2NjdXBhdGlvbkNvZGUgJiYgaGFzQXRobGV0ZVZhbHVlKSB7CiAgICAgICAgaXNQcm9mZXNzaW9uYWxBdGhsZXRlID0gdHJ1ZTsKICAgICAgICBjb25zb2xlLmxvZygiQXRobGV0ZSBzdGF0dXMgZGV0ZWN0ZWQgZnJvbSBPYnNlcnZhdGlvbiBmcm9tIHBlcnNvbmEgdmVjdG9yOiIsIHJlc291cmNlLmlkKTsKICAgICAgfQogICAgfQogIH0pOwoKCiAgLy8gMi4gQ2hlY2sgbWVkaWNhdGlvbnMgZm9yIGRvcGluZyBzdWJzdGFuY2VzCiAgLy8gQ2hlY2sgYnVuZGxlLmlkZW50aWZpZXIudmFsdWUKICBpZiAoCiAgICBlcGlEYXRhLmlkZW50aWZpZXIgJiYKICAgIFdBREFfQlVORExFX0lERU5USUZJRVJfTElTVC5pbmNsdWRlcyhlcGlEYXRhLmlkZW50aWZpZXIudmFsdWUpCiAgKSB7CiAgICBjb25zb2xlLmxvZygi8J+UlyBNYXRjaGVkIGVQSSBEb3BpbmcgQnVuZGxlLmlkZW50aWZpZXI6IiwgZXBpRGF0YS5pZGVudGlmaWVyLnZhbHVlKTsKICAgIGlzUHJvaGliaXRlZERydWcgPSB0cnVlOwogIH0KCiAgLy8gQ2hlY2sgTWVkaWNpbmFsUHJvZHVjdERlZmluaXRpb24uaWRlbnRpZmllci52YWx1ZQogIGVwaURhdGEuZW50cnkuZm9yRWFjaCgoZW50cnkpID0+IHsKICAgIGNvbnN0IHJlcyA9IGVudHJ5LnJlc291cmNlOwogICAgaWYgKHJlcz8ucmVzb3VyY2VUeXBlID09PSAiTWVkaWNpbmFsUHJvZHVjdERlZmluaXRpb24iKSB7CiAgICAgIGNvbnN0IGlkcyA9IHJlcy5pZGVudGlmaWVyIHx8IFtdOwogICAgICBpZHMuZm9yRWFjaCgoaWQpID0+IHsKICAgICAgICBpZiAoV0FEQV9MSVNULmluY2x1ZGVzKGlkLnZhbHVlKSkgewogICAgICAgICAgY29uc29sZS5sb2coIvCfkoogTWF0Y2hlZCBEb3BpbmcgTWVkaWNpbmFsUHJvZHVjdERlZmluaXRpb24uaWRlbnRpZmllcjoiLCBpZC52YWx1ZSk7CiAgICAgICAgICBpc1Byb2hpYml0ZWREcnVnID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0pOwoKCiAgLy8gZVBJIHRyYXNsYXRpb24gZnJvbSB0ZXJtaW5vbG9neSBjb2RlcyB0byB0aGVpciBodW1hbiByZWRhYmxlIHRyYW5zbGF0aW9ucyBpbiB0aGUgc2VjdGlvbnMKICBsZXQgY29tcG9zaXRpb25zID0gMDsKICBsZXQgY2F0ZWdvcmllcyA9IFtdOwogIGVwaS5lbnRyeS5mb3JFYWNoKChlbnRyeSkgPT4gewogICAgaWYgKGVudHJ5LnJlc291cmNlLnJlc291cmNlVHlwZSA9PSAiQ29tcG9zaXRpb24iKSB7CiAgICAgIGNvbXBvc2l0aW9ucysrOwogICAgICAvL0l0ZXJhdGVkIHRocm91Z2ggdGhlIENvbmRpdGlvbiBlbGVtZW50IHNlYXJjaGluZyBmb3IgY29uZGl0aW9ucwogICAgICBlbnRyeS5yZXNvdXJjZS5leHRlbnNpb24uZm9yRWFjaCgoZWxlbWVudCkgPT4gewoKICAgICAgICAvLyBDaGVjayBpZiB0aGUgcG9zaXRpb24gb2YgdGhlIGV4dGVuc2lvblsxXSBpcyBjb3JyZWN0CiAgICAgICAgaWYgKGVsZW1lbnQuZXh0ZW5zaW9uWzFdLnVybCA9PSAiY29uY2VwdCIpIHsKICAgICAgICAgIC8vIFNlYXJjaCB0aHJvdWdoIHRoZSBkaWZmZXJlbnQgdGVybWlub2xvZ2llcyB0aGF0IG1heSBiZSBhdmFpYmxlIHRvIGNoZWNrIGluIHRoZSBjb25kaXRpb24KICAgICAgICAgIGlmIChlbGVtZW50LmV4dGVuc2lvblsxXS52YWx1ZUNvZGVhYmxlUmVmZXJlbmNlLmNvbmNlcHQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGVsZW1lbnQuZXh0ZW5zaW9uWzFdLnZhbHVlQ29kZWFibGVSZWZlcmVuY2UuY29uY2VwdC5jb2RpbmcuZm9yRWFjaCgKICAgICAgICAgICAgICAoY29kaW5nKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRXh0ZW5zaW9uOiAiICsgZWxlbWVudC5leHRlbnNpb25bMF0udmFsdWVTdHJpbmcgKyAiOiIgKyBjb2RpbmcuY29kZSkKICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBjb2RlIGlzIGluIHRoZSBsaXN0IG9mIGNhdGVnb3JpZXMgdG8gc2VhcmNoCiAgICAgICAgICAgICAgICBpZiAobGlzdE9mQ2F0ZWdvcmllc1RvU2VhcmNoLmluY2x1ZGVzKGNvZGluZy5jb2RlKSkgewogICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgY2F0ZWdvcnkgaXMgYWxyZWFkeSBpbiB0aGUgbGlzdCBvZiBjYXRlZ29yaWVzCiAgICAgICAgICAgICAgICAgIGNhdGVnb3JpZXMucHVzaChlbGVtZW50LmV4dGVuc2lvblswXS52YWx1ZVN0cmluZyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CgoKICBpZiAoY29tcG9zaXRpb25zID09IDApIHsKICAgIHRocm93IG5ldyBFcnJvcignQmFkIGVQSTogbm8gY2F0ZWdvcnkgIkNvbXBvc2l0aW9uIiBmb3VuZCcpOwogIH0KCiAgaWYgKGNhdGVnb3JpZXMubGVuZ3RoID09IDApIHsKICAgIC8vIHRocm93IG5ldyBFcnJvcigiTm8gY2F0ZWdvcmllcyBmb3VuZCIsIGNhdGVnb3JpZXMpOwogICAgcmV0dXJuIGh0bWxEYXRhOwogIH0KICBpZiAoaXNQcm9mZXNzaW9uYWxBdGhsZXRlICYmIGlzUHJvaGliaXRlZERydWcpIHsKICAgIHJldHVybiBhd2FpdCBhbm5vdGF0ZUhUTUxzZWN0aW9uKGNhdGVnb3JpZXMsIGVuaGFuY2VUYWcpOwogIH0KICBlbHNlIHsKCiAgICBjb25zb2xlLndhcm4oIk5vIGRvcGluZyByaXNrIGNvbmRpdGlvbiBtZXQuIik7CiAgICByZXR1cm4gaHRtbERhdGE7CiAgfQoKfTsKCgpmdW5jdGlvbiBnZXRSZXBvcnQobGFuZykgewogIGNvbnNvbGUubG9nKCJHZW5lcmF0aW5nIHJlcG9ydCBpbiBsYW5ndWFnZToiLCBsYW5nKTsKICByZXR1cm4geyBtZXNzYWdlOiBnZXRFeHBsYW5hdGlvbihsYW5nKSwgc3RhdHVzOiAiIiB9OwoKCn0KCi8vIC0tLSBHZXQgdXNlci1mYWNpbmcgcmVwb3J0IHNlbnRlbmNlIGluIHRoZSBzZWxlY3RlZCBsYW5ndWFnZSAtLS0KZnVuY3Rpb24gZ2V0RXhwbGFuYXRpb24obGFuZykgewogIGNvbnNvbGUubG9nKCJHZW5lcmF0aW5nIGV4cGxhbmF0aW9uIGluIGxhbmd1YWdlOiIsIGxhbmcpOwogIHJldHVybiAiIjsKfQoKLy8gLS0tIEV4cG9ydGVkIEFQSSAtLS0KcmV0dXJuIHsKICBlbmhhbmNlOiBlbmhhbmNlLAogIGdldFNwZWNpZmljYXRpb246IGdldFNwZWNpZmljYXRpb24sCiAgZXhwbGFuYXRpb246IChsYW5ndWFnZSkgPT4gZ2V0RXhwbGFuYXRpb24obGFuZ3VhZ2UgfHwgbGFuZyksCiAgcmVwb3J0OiAobGFuZ3VhZ2UpID0+IGdldFJlcG9ydChsYW5ndWFnZSB8fCBsYW5nKSwKfTs=",
      "_title": {
        "extension": [
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "es"
              },
              {
                "url": "content",
                "valueString": "Lente para aviso de doping"
              }
            ]
          },
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "pt"
              },
              {
                "url": "content",
                "valueString": "Lente para aviso de doping"
              }
            ]
          },
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "da"
              },
              {
                "url": "content",
                "valueString": "Linse til dopingadvarsel"
              }
            ]
          }
        ]
      }
    }
  ]
}